@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Знайомство з ASP</h1>
</div>

<!-- Отображение сообщений -->
@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["Info"] != null)
{
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        @TempData["Info"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<!-- Код подтверждения захода -->
@if (Context.Session.GetString("ConfirmationCode") != null)
{
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Код подтверждения захода</h5>
        </div>
        <div class="card-body">
            <p>Ваш код подтверждения: <strong class="text-primary">@Context.Session.GetString("ConfirmationCode")</strong></p>
            <p class="text-muted small">Этот код подтверждает ваш заход на сайт в @DateTime.Now.ToString("HH:mm")</p>
            
            <form asp-action="ConfirmVisit" method="post" class="mt-3">
                <div class="input-group">
                    <input type="text" name="confirmationCode" class="form-control" placeholder="Введите код подтверждения" required>
                    <button class="btn btn-success" type="submit">Подтвердить заход</button>
                </div>
            </form>
        </div>
    </div>
}

<h2>Зміст</h2>
<h3>
    <a asp-area="" asp-controller="Home" asp-action="Razor">
        Технологія Razor
    </a>
</h3>
<h3>
    <a asp-area="" asp-controller="Home" asp-action="IoC">
        Інверсія управління (Inversion of Control)
    </a>
</h3>
<h3>
    <a asp-area="" asp-controller="Home" asp-action="Privacy">
        Privacy Policy
    </a>
</h3>
<h3>
    <a asp-area="" asp-controller="Home" asp-action="VisitStats">
        Статистика заходів
    </a>
</h3>

@* Временная кнопка для тестирования истории просмотров *@
<div class="mt-4">
    <h4>Тест истории просмотров:</h4>
    <a asp-controller="Shop" asp-action="Index" class="btn btn-primary">
        <i class="bi bi-shop"></i> Перейти в магазин для просмотра товаров
    </a>
</div>

@* Секция просмотренных товаров *@
@{
    var viewedProducts = ViewData["ViewedProducts"] as IEnumerable<ASP_421.Data.Entities.Product>;
}

@* Отладочная информация *@
<div class="alert alert-info mt-4">
    <h5>Отладочная информация:</h5>
    <p><strong>Количество просмотренных товаров:</strong> @(viewedProducts?.Count() ?? 0)</p>
    <p><strong>Session ID:</strong> @Context.Session.Id</p>
    @if (viewedProducts != null && viewedProducts.Any())
    {
        <p><strong>Товары:</strong></p>
        <ul>
            @foreach (var product in viewedProducts)
            {
                <li>@product.Name (Группа: @product.Group?.Name)</li>
            }
        </ul>
    }
    else
    {
        <p><strong>Нет просмотренных товаров</strong></p>
    }
</div>

@if (viewedProducts != null && viewedProducts.Any())
{
    @await Html.PartialAsync("_ViewedProducts", new ASP_421.Models.Shop.ViewedProductsViewModel 
    { 
        Products = viewedProducts, 
        MaxItems = 8,
        Title = "Нещодавно переглянуті товари з усіх груп"
    })
}
