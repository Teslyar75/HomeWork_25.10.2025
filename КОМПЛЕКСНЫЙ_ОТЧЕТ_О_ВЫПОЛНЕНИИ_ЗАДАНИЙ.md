# –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –æ—Ç—á–µ—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤—Å–µ—Ö –∑–∞–¥–∞–Ω–∏–π

## üìã –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π

### ‚úÖ **–ó–ê–î–ê–ù–ò–ï 1: –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç—É—Å–æ–≤ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É**

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- ‚úÖ –î–ª—è –∑–∞–∫–∞–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
- ‚úÖ –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω  
- ‚úÖ –í–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É –ø–æ–∑–∂–µ
- ‚úÖ –ï—Å–ª–∏ –Ω–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, —Ç–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å, —Å—Ä–∞–∑—É –≤—ã–≤–æ–¥–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
**–§–∞–π–ª—ã:** `Views/Shop/Product.cshtml`, `Views/Cart/Index.cshtml`, `Views/Shop/Group.cshtml`

```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ü–ï–†–ï–î –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∑–∞–ø—Ä–æ—Å–∞
const isAuthenticated = @(Context.User.Identity?.IsAuthenticated ?? false ? "true" : "false");

if (!isAuthenticated) {
    showCartNotification('–î–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤ –¥–æ –∫–æ—à–∏–∫–∞ –ø–æ—Ç—Ä—ñ–±–Ω–æ —É–≤—ñ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'warning');
    return; // –ù–ï –û–¢–ü–†–ê–í–õ–Ø–ï–ú –ó–ê–ü–†–û–°
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**

---

### ‚úÖ **–ó–ê–î–ê–ù–ò–ï 2: –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∫–∏ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–π —Ç–æ–≤–∞—Ä–æ–≤**

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- ‚úÖ –í—ã–±–∏—Ä–∞—Ç—å 6 –ø–æ–∑–∏—Ü–∏–π: 3 –∏–∑ –¥–∞–Ω–Ω–æ–π –≥—Ä—É–ø–ø—ã (—Å–ª—É—á–∞–π–Ω–æ, –∫—Ä–æ–º–µ –¥–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞) + 3 –∏–∑ –¥—Ä—É–≥–∏—Ö –≥—Ä—É–ø–ø (—Ç–∞–∫–∂–µ —Å–ª—É—á–∞–π–Ω–æ)

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
**–§–∞–π–ª:** `Controllers/ShopController.cs`

```csharp
// –ü–æ–ª—É—á–∞–µ–º –ø–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã: 3 –∏–∑ —Ç–æ–π –∂–µ –≥—Ä—É–ø–ø—ã + 3 –∏–∑ –¥—Ä—É–≥–∏—Ö –≥—Ä—É–ø–ø
var sameGroupProducts = product.Group.Products
    .Where(p => p.DeletedAt == null && p.Id != product.Id)
    .OrderBy(x => Guid.NewGuid()) // –°–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
    .Take(3)
    .ToList();

// –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –≥—Ä—É–ø–ø (—Å–ª—É—á–∞–π–Ω–æ)
var otherGroupsProducts = _dataAccessor.ProductGroups()
    .Where(g => g.DeletedAt == null && g.Id != product.GroupId)
    .SelectMany(g => g.Products.Where(p => p.DeletedAt == null))
    .OrderBy(x => Guid.NewGuid()) // –°–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
    .Take(3)
    .ToList();

// –û–±—ä–µ–¥–∏–Ω—è–µ–º: 3 –∏–∑ —Ç–æ–π –∂–µ –≥—Ä—É–ø–ø—ã + 3 –∏–∑ –¥—Ä—É–≥–∏—Ö –≥—Ä—É–ø–ø = 6 —Ç–æ–≤–∞—Ä–æ–≤
var relatedProducts = sameGroupProducts.Concat(otherGroupsProducts).ToList();
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**

---

### ‚úÖ **–ó–ê–î–ê–ù–ò–ï 3: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –∫–æ—Ä–∑–∏–Ω—ã**

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

##### 3.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è CartItem:
- ‚úÖ –ù–æ–≤–∞—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–æ–ª—å—à–µ –Ω—É–ª—è
- ‚úÖ –ï—Å–ª–∏ –º–µ–Ω—å—à–µ –Ω—É–ª—è, —Ç–æ —ç—Ç–æ –æ—à–∏–±–∫–∞ - throw new Exception
- ‚úÖ –ï—Å–ª–∏ —Ä–∞–≤–Ω–æ –Ω—É–ª—é, —Ç–æ –ø–æ–∑–∏—Ü–∏—é —Å–ª–µ–¥—É–µ—Ç —É–¥–∞–ª–∏—Ç—å –≤–º–µ—Å—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω—É–ª–µ–≤–æ–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- ‚úÖ –ù–æ–≤–∞—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç —Å–∫–ª–∞–¥—Å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
**–§–∞–π–ª:** `Data/DataAccessor.cs`

```csharp
public void ModifyCartItem(Guid userId, Guid productId, int increment)
{
    var cartItem = GetCartItem(userId, productId);
    if (cartItem != null)
    {
        var newQuantity = cartItem.Quantity + increment;
        
        // –ï—Å–ª–∏ –Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ–Ω—å—à–µ –Ω—É–ª—è, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
        if (newQuantity < 0)
        {
            throw new ArgumentException("–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥'—î–º–Ω–æ—é");
        }
        
        // –ï—Å–ª–∏ –Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–≤–Ω–æ –Ω—É–ª—é, —É–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä
        if (newQuantity == 0)
        {
            RemoveFromCart(userId, productId);
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∫–ª–∞–¥—Å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏
        if (newQuantity > product.Stock)
        {
            throw new InvalidOperationException($"–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Ç–æ–≤–∞—Ä—É –Ω–∞ —Å–∫–ª–∞–¥—ñ. –î–æ—Å—Ç—É–ø–Ω–æ: {product.Stock}, –∑–∞–ø–∏—Ç—É—î—Ç—å—Å—è: {newQuantity}");
        }
    }
}
```

##### 3.2 –°–æ–æ–±—â–µ–Ω–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "-", —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω—É–ª–µ–≤–æ–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- ‚úÖ –û –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ
- ‚úÖ –û –æ–±—â–∏—Ö –æ—à–∏–±–∫–∞—Ö ("–°—Ç–∞–ª–∞—Å—å –ø–æ–º–∏–ª–∫–∞, –ø–æ–≤—Ç–æ—Ä—ñ—Ç—å –¥—ñ—é –ø—ñ–∑–Ω—ñ—à–µ")

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
**–§–∞–π–ª:** `Views/Cart/Index.cshtml`

```javascript
function decreaseQuantity(productId, button) {
    const currentValue = parseInt(input.value) || 1;
    
    // –ï—Å–ª–∏ —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–≤–Ω–æ 1, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
    if (currentValue === 1) {
        if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä –∑ –∫–æ—Ä–∑–∏–Ω–∏?')) {
            return;
        }
    }
    
    modifyCartItem(productId, -1);
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
if (data.errorMessage && data.errorMessage.includes('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Ç–æ–≤–∞—Ä—É –Ω–∞ —Å–∫–ª–∞–¥—ñ')) {
    showCartNotification(data.errorMessage, 'warning');
} else if (data.errorMessage && data.errorMessage.includes('–≤—ñ–¥\'—î–º–Ω–æ—é')) {
    showCartNotification('–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥\'—î–º–Ω–æ—é', 'warning');
} else {
    showCartNotification(data.errorMessage || '–°—Ç–∞–ª–∞—Å—å –ø–æ–º–∏–ª–∫–∞, –ø–æ–≤—Ç–æ—Ä—ñ—Ç—å –¥—ñ—é –ø—ñ–∑–Ω—ñ—à–µ', 'danger');
}
```

##### 3.3 –ö–Ω–æ–ø–∫–∞ "—Ö" —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏:
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–∞ –±–∞–∑–µ ModifyCartItem —Å –ø–µ—Ä–µ–¥–∞—á–µ–π inc, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω—É–ª–µ–≤–æ–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ-–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```html
<button class="btn btn-outline-danger btn-sm" 
        onclick="confirmRemoveFromCart('@item.ProductId.ToString()')"
        title="–í–∏–¥–∞–ª–∏—Ç–∏ –∑ –∫–æ—Ä–∑–∏–Ω–∏">
    <i class="bi bi-x-lg"></i>
</button>
```

```javascript
function confirmRemoveFromCart(productId) {
    if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–æ–≤–∞—Ä –∑ –∫–æ—Ä–∑–∏–Ω–∏?')) {
        return;
    }
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π API –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ ModifyCartItem —Å increment = -currentQuantity
    const currentQuantity = parseInt(input.value) || 1;
    modifyCartItem(productId, -currentQuantity);
}
```

##### 3.4 –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞:
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```html
<a asp-controller="Shop" asp-action="Product" asp-route-slug="@item.Product.Slug" class="me-3">
    <img src="/Storage/Item/@item.Product.ImageUrl" 
         style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; cursor: pointer;" 
         alt="@item.Product.Name"
         title="–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —Ç–æ–≤–∞—Ä—É">
</a>
```

##### 3.5 –ê–Ω–∞–ª–∏–∑ –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ:
- ‚úÖ –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –µ–≥–æ –Ω–∞–ª–∏—á–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É" / "–ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–æ—Ä–∑–∏–Ω–µ" –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
**–§–∞–π–ª:** `Views/Shop/Product.cshtml`

```javascript
function checkProductInCart(productId) {
    fetch('/api/cart')
        .then(response => response.json())
        .then(data => {
            if (data.status === 'Ok' && data.data && data.data.items) {
                const cartItems = data.data.items;
                const productInCart = cartItems.find(item => item.productId === productId);
                updateCartButton(productInCart);
            }
        });
}

function updateCartButton(productInCart) {
    if (productInCart) {
        // –¢–æ–≤–∞—Ä –µ—Å—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω–µ
        cartButtonText.textContent = '–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∫–æ—à–∏–∫–∞';
        cartIcon.className = 'bi bi-cart-check';
        cartButton.classList.add('btn-success');
        cartButton.onclick = function() {
            window.location.href = '/Cart';
        };
    } else {
        // –¢–æ–≤–∞—Ä–∞ –Ω–µ—Ç –≤ –∫–æ—Ä–∑–∏–Ω–µ
        cartButtonText.textContent = '–î–æ–¥–∞—Ç–∏ –≤ –∫–æ—à–∏–∫';
        cartIcon.className = 'bi bi-cart-plus';
        cartButton.classList.add('btn-primary');
        cartButton.onclick = function() {
            addToCart('@product?.Id');
        };
    }
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**

---

### ‚úÖ **–ó–ê–î–ê–ù–ò–ï 4: –£—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤**

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

##### 4.1 DataAccessor::RepeatCart:
- ‚úÖ –û–±–µ—Å–ø–µ—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–≥–æ, —á—Ç–æ –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ–µ –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Ç–æ–º—É –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–≥–æ, —á—Ç–æ —Ç–æ–≤–∞—Ä –Ω–µ –±—ã–ª —É–¥–∞–ª–µ–Ω
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–≥–æ, —á—Ç–æ —Ç–æ–≤–∞—Ä –µ—Å—Ç—å –≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
**–§–∞–π–ª:** `Data/DataAccessor.cs`

```csharp
public void RepeatCart(Guid currentUserId, Guid sourceUserId, IEnumerable<CartItem> sourceCartItems)
{
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ–≥–æ –∑–∞–∫–∞–∑–∞ —Ç–æ–º—É –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    if (currentUserId != sourceUserId)
    {
        throw new UnauthorizedAccessException("–ù–µ –º–æ–∂–Ω–∞ –ø–æ–≤—Ç–æ—Ä—é–≤–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—à–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞");
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∏—Ö –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
    foreach (var item in sourceCartItems)
    {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–≤–∞—Ä –Ω–µ –±—ã–ª —É–¥–∞–ª–µ–Ω
        var product = _dataContext.Products.FirstOrDefault(p => p.Id == item.ProductId && p.DeletedAt == null);
        if (product == null)
        {
            throw new InvalidOperationException($"–¢–æ–≤–∞—Ä '{item.Product?.Name ?? "Unknown"}' –±—ñ–ª—å—à–µ –Ω–µ —ñ—Å–Ω—É—î –∞–±–æ –±—É–≤ –≤–∏–¥–∞–ª–µ–Ω–∏–π");
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ
        if (product.Stock < item.Quantity)
        {
            throw new InvalidOperationException($"–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Ç–æ–≤–∞—Ä—É '{product.Name}' –Ω–∞ —Å–∫–ª–∞–¥—ñ. –î–æ—Å—Ç—É–ø–Ω–æ: {product.Stock}, –ø–æ—Ç—Ä—ñ–±–Ω–æ: {item.Quantity}");
        }
    }
}
```

##### 4.2 DataAccessor::CheckoutCart:
- ‚úÖ –£–º–µ–Ω—å—à–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –æ—Å—Ç–∞—Ç–∫–∞—Ö (stock) –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤ –∑–∞–∫–∞–∑–µ

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```csharp
public void CheckoutCart(Guid userId)
{
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–µ—Ä–µ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º
    foreach (var item in cartItems)
    {
        var product = _dataContext.Products.FirstOrDefault(p => p.Id == item.ProductId && p.DeletedAt == null);
        if (product == null)
        {
            throw new InvalidOperationException($"–¢–æ–≤–∞—Ä '{item.Product?.Name ?? "Unknown"}' –±—ñ–ª—å—à–µ –Ω–µ —ñ—Å–Ω—É—î");
        }

        if (product.Stock < item.Quantity)
        {
            throw new InvalidOperationException($"–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Ç–æ–≤–∞—Ä—É '{product.Name}' –Ω–∞ —Å–∫–ª–∞–¥—ñ. –î–æ—Å—Ç—É–ø–Ω–æ: {product.Stock}, –ø–æ—Ç—Ä—ñ–±–Ω–æ: {item.Quantity}");
        }
    }

    // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞–∫–∞–∑–∞ –∏ —É–º–µ–Ω—å—à–∞–µ–º —Å–∫–ª–∞–¥—Å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏
    foreach (var item in cartItems)
    {
        var product = _dataContext.Products.FirstOrDefault(p => p.Id == item.ProductId && p.DeletedAt == null);
        if (product != null)
        {
            // –£–º–µ–Ω—å—à–∞–µ–º —Å–∫–ª–∞–¥—Å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏
            product.Stock -= item.Quantity;
            if (product.Stock < 0)
            {
                product.Stock = 0; // –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
            }
        }
    }
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**

---

## üéØ **–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò**

### ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤:**
- –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ —Å –¥–∞—Ç–æ–π, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–∑–∏—Ü–∏–π, —Å—Ç–æ–∏–º–æ—Å—Ç—å—é –∏ —Å—Ç–∞—Ç—É—Å–æ–º
- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–∫–∞–∑–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–æ–≤–∞—Ä–æ–≤ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

### ‚úÖ **–£–ª—É—á—à–µ–Ω–∏—è UI:**
- –ó–µ–ª–µ–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ –∫–æ—Ä–∑–∏–Ω—ã (–∫–∞–∫ –≤ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ)
- –ö—Ä—É–≥–ª–∞—è –∫–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö

### ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–ª–∞–¥—Å–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

---

## üìä **–ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê**

| –ó–∞–¥–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|--------|----------|
| 1. –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç—É—Å–æ–≤ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ | ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û | –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ |
| 2. –ê–ª–≥–æ—Ä–∏—Ç–º –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–π —Ç–æ–≤–∞—Ä–æ–≤ | ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û | 3 —Ç–æ–≤–∞—Ä–∞ –∏–∑ —Ç–æ–π –∂–µ –≥—Ä—É–ø–ø—ã + 3 –∏–∑ –¥—Ä—É–≥–∏—Ö –≥—Ä—É–ø–ø |
| 3. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∫–æ—Ä–∑–∏–Ω–æ–π | ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û | –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é |
| 4. –£—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ | ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û | –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã |

## üèÜ **–û–ë–©–ò–ô –°–¢–ê–¢–£–°: –í–°–ï –ó–ê–î–ê–ù–ò–Ø –í–´–ü–û–õ–ù–ï–ù–´**

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—Å–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –∏ –≤–∫–ª—é—á–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞.
